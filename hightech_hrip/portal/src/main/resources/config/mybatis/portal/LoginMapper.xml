<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd" >
<mapper namespace="com.siping.hrip.portal.user.mapper.LoginMapper">

    <resultMap id="userMap" type="com.siping.domain.portal.entity.User">
        <id column="id" property="id" jdbcType="VARCHAR" />
        <result column="username" property="username" jdbcType="VARCHAR" />
        <result column="pwd_hash" property="pwdHash" jdbcType="VARCHAR" />
        <result column="pwd_iterator" property="pwdIterator" jdbcType="INTEGER" />
        <result column="pwd_salt" property="pwdSalt" jdbcType="VARCHAR" />
        <result column="user_type" property="userType" jdbcType="INTEGER" />
        <result column="enabled" property="enabled" jdbcType="INTEGER" />
        <result column="create_date" property="createDate" jdbcType="DATE" />
        <result column="create_by" property="createBy" jdbcType="BIGINT" />
        <result column="update_date" property="updateDate" jdbcType="DATE" />
        <result column="update_by" property="updateBy" jdbcType="BIGINT" />   
    </resultMap>
    <sql id="user_Column_List">
		id, username, pwd_hash, pwd_iterator, pwd_salt, user_type, enabled,  DATE_FORMAT(create_date,"%Y-%m-%d %H:%i:%s") create_date,
		create_by ,DATE_FORMAT(update_date,"%Y-%m-%d") update_date, update_by
	</sql>
    
    <!-- 根据username查询账号信息 -->
	<select id="login" parameterType="com.siping.domain.portal.entity.UserLoginRequest" resultMap="userMap">
		select
		<include refid="user_Column_List" />
		from users where enabled = '1'
		<if test="username !='' and username!=null">
			and username =#{username} 
		</if>
	</select>
    
    <!-- 重置密码 -->
    <update id="resetPwd">
        UPDATE users SET 
        <if test="pwdHash !=''">
            pwd_hash=#{pwdHash},
        </if>
        <if test="id !=''">
            update_by=#{id} , update_date=now()
        </if>
        where 1=1 and username=#{username};
    </update>
    
</mapper>